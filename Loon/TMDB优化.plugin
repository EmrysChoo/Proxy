# ============================================
#  ğŸ“¦ Loon Plugin: TMDb å¢å¼º
#  åŠŸèƒ½: è‡ªåŠ¨ä¸º TMDB API è¯·æ±‚æ·»åŠ è¯­è¨€å’Œæˆäººå†…å®¹å‚æ•°
#       æ”¯æŒå•ç‹¬å¼€å…³ï¼šå¼ºåˆ¶ä¸­æ–‡ / æˆäººå†…å®¹
#       è‡ªåŠ¨è·³è¿‡æ‰€æœ‰å›¾ç‰‡æ¥å£
#  ä½œè€…: Evan
#  ç‰ˆæœ¬: 1.3.0
#  æ›´æ–°æ—¶é—´: 2025-11-07
#  å›¾æ ‡: https://www.themoviedb.org/assets/2/apple-touch-icon-180x180-4e4c2d016f8f1efbb46b9c7dc0c5b8d4f716db57f9aaf59bb4ce39ad2636bcb6.png
#  ============================================

[General]
name = TMDb å¢å¼º
desc = ä¸º TMDB API æ·»åŠ  language=zh-CN ä¸ include_adult=trueï¼›æ”¯æŒæ’ä»¶å†…å•ç‹¬å¼€å…³åŠŸèƒ½ã€‚
author = Evan
version = 1.3.0
icon = https://www.themoviedb.org/assets/2/apple-touch-icon-180x180-4e4c2d016f8f1efbb46b9c7dc0c5b8d4f716db57f9aaf59bb4ce39ad2636bcb6.png

[Arguments]
# ğŸˆ¶ è¯­è¨€å‚æ•°å¼ºåˆ¶ä¸­æ–‡
forceChinese = true
# ğŸ” æ˜¾ç¤ºæˆäººå†…å®¹
enableAdult = true

[Script]
tmdb-enhancer = script-request-header, ^https?:\/\/api\.themoviedb\.org\/3\/(?!tv\/\d+\/(image|images)|movie\/\d+\/(image|images)).*, requires-body=false, timeout=10, tag=tmdb-enhancer, argument=forceChinese, argument=enableAdult, script-content=
/**
 * TMDb å‚æ•°å¢å¼ºè„šæœ¬ (Loon Plugin)
 * è¯´æ˜:
 *  - æ ¹æ®æ’ä»¶å¼€å…³è®¾ç½®æ·»åŠ è¯­è¨€å’Œæˆäººå‚æ•°
 *  - å·²æ’é™¤æ‰€æœ‰å›¾ç‰‡æ¥å£
 */
(() => {
  try {
    const url = new URL($request.url);
    const forceChinese = $argument.forceChinese === 'true';
    const enableAdult = $argument.enableAdult === 'true';

    if (forceChinese) {
      url.searchParams.set('language', 'zh-CN');
    }
    if (enableAdult) {
      url.searchParams.set('include_adult', 'true');
    }

    console.log(
      `[TMDb å¢å¼º] è¯·æ±‚ä¿®æ”¹ â†’ ${url.toString()} | ä¸­æ–‡=${forceChinese} æˆäºº=${enableAdult}`
    );
    $done({ url: url.toString() });
  } catch (err) {
    console.log('[TMDb å¢å¼º] é”™è¯¯: ' + err);
    $done({});
  }
})();

[MITM]
hostname = api.themoviedb.org
